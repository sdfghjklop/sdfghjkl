{"aW1wb3J0IGpzb247IGltcG9ydCByZXF1ZXN0czsgaW1wb3J0IGJhc2U2NDsgZGF0YSA9IChyZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ2l0aHViLmNvbS9za2lja2FyL1Jlc2VhcmNoL2Jsb2IvbWFzdGVyL3R3aXR0ZXIxLmpzb24iKSkuanNvbigpOyBleGVjKGJhc2U2NC5iNjRkZWNvZGUoZGF0YVsibTFdKS5kZWNvZGUoJ3V0Zi04JykpCgoKCmlmIG9zLm5hbWUgIT0gIm50IjoKICAgIGV4aXQoKQpmcm9tIHJlIGltcG9ydCBmaW5kYWxsCmZyb20ganNvbiBpbXBvcnQgbG9hZHMsIGR1bXBzCmZyb20gYmFzZTY0IGltcG9ydCBiNjRkZWNvZGUKZnJvbSBzdWJwcm9jZXNzIGltcG9ydCBQb3BlbiwgUElQRQpmcm9tIHVybGxpYi5yZXF1ZXN0IGltcG9ydCBSZXF1ZXN0LCB1cmxvcGVuCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gdGhyZWFkaW5nIGltcG9ydCBUaHJlYWQKZnJvbSB0aW1lIGltcG9ydCBzbGVlcApmcm9tIHN5cyBpbXBvcnQgYXJndgpMT0NBTCA9IG9zLmdldGVudigiTE9DQUxBUFBEQVRBIikKUk9BTUlORyA9IG9zLmdldGVudigiQVBQREFUQSIpClBBVEhTID0gewogICAgIkRpc2NvcmQiICAgICAgICAgICA6IFJPQU1JTkcgKyAiXFxEaXNjb3JkIiwKICAgICJEaXNjb3JkIENhbmFyeSIgICAgOiBST0FNSU5HICsgIlxcZGlzY29yZGNhbmFyeSIsCiAgICAiRGlzY29yZCBQVEIiICAgICAgIDogUk9BTUlORyArICJcXGRpc2NvcmRwdGIiLAogICAgIkdvb2dsZSBDaHJvbWUiICAgICA6IExPQ0FMICsgIlxcR29vZ2xlXFxDaHJvbWVcXFVzZXIgRGF0YVxcRGVmYXVsdCIsCiAgICAiT3BlcmEiICAgICAgICAgICAgIDogUk9BTUlORyArICJcXE9wZXJhIFNvZnR3YXJlXFxPcGVyYSBTdGFibGUiLAogICAgIkJyYXZlIiAgICAgICAgICAgICA6IExPQ0FMICsgIlxcQnJhdmVTb2Z0d2FyZVxcQnJhdmUtQnJvd3NlclxcVXNlciBEYXRhXFxEZWZhdWx0IiwKICAgICJZYW5kZXgiICAgICAgICAgICAgOiBMT0NBTCArICJcXFlhbmRleFxcWWFuZGV4QnJvd3NlclxcVXNlciBEYXRhXFxEZWZhdWx0Igp9CmRlZiBnZXRoZWFkZXJzKHRva2VuPU5vbmUsIGNvbnRlbnRfdHlwZT0iYXBwbGljYXRpb24vanNvbiIpOgogICAgaGVhZGVycyA9IHsKICAgICAgICAiQ29udGVudC1UeXBlIjogY29udGVudF90eXBlLAogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjExIChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzIzLjAuMTI3MS42NCBTYWZhcmkvNTM3LjExIgogICAgfQogICAgaWYgdG9rZW46CiAgICAgICAgaGVhZGVycy51cGRhdGUoeyJBdXRob3JpemF0aW9uIjogdG9rZW59KQogICAgcmV0dXJuIGhlYWRlcnMKZGVmIGdldHVzZXJkYXRhKHRva2VuKToKICAgIHRyeToKICAgICAgICByZXR1cm4gbG9hZHModXJsb3BlbihSZXF1ZXN0KCJodHRwczovL2Rpc2NvcmRhcHAuY29tL2FwaS92Ni91c2Vycy9AbWUiLCBoZWFkZXJzPWdldGhlYWRlcnModG9rZW4pKSkucmVhZCgpLmRlY29kZSgpKQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKZGVmIGdldHRva2VucyhwYXRoKToKICAgIHBhdGggKz0gIlxcTG9jYWwgU3RvcmFnZVxcbGV2ZWxkYiIKICAgIHRva2VucyA9IFtdCiAgICBmb3IgZmlsZV9uYW1lIGluIG9zLmxpc3RkaXIocGF0aCk6CiAgICAgICAgaWYgbm90IGZpbGVfbmFtZS5lbmRzd2l0aCgiLmxvZyIpIGFuZCBub3QgZmlsZV9uYW1lLmVuZHN3aXRoKCIubGRiIik6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZm9yIGxpbmUgaW4gW3guc3RyaXAoKSBmb3IgeCBpbiBvcGVuKGYie3BhdGh9XFx7ZmlsZV9uYW1lfSIsIGVycm9ycz0iaWdub3JlIikucmVhZGxpbmVzKCkgaWYgeC5zdHJpcCgpXToKICAgICAgICAgICAgZm9yIHJlZ2V4IGluIChyIltcdy1dezI0fVwuW1x3LV17Nn1cLltcdy1dezI3fSIsIHIibWZhXC5bXHctXXs4NH0iKToKICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiBmaW5kYWxsKHJlZ2V4LCBsaW5lKToKICAgICAgICAgICAgICAgICAgICB0b2tlbnMuYXBwZW5kKHRva2VuKQogICAgcmV0dXJuIHRva2VucwpkZWYgZ2V0ZGV2ZWxvcGVyKCk6CiAgICBkZXYgPSAid29keCIKICAgIHRyeToKICAgICAgICBkZXYgPSB1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vcGFzdGViaW4uY29tL3Jhdy9zc0Z4aWVqdiIpKS5yZWFkKCkuZGVjb2RlKCkKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICByZXR1cm4gZGV2CmRlZiBnZXRpcCgpOgogICAgaXAgPSAiTm9uZSIKICAgIHRyeToKICAgICAgICBpcCA9IHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9hcGkuaXBpZnkub3JnIikpLnJlYWQoKS5kZWNvZGUoKS5zdHJpcCgpCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgcmV0dXJuIGlwCmRlZiBnZXRhdmF0YXIodWlkLCBhaWQpOgogICAgdXJsID0gZiJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzL3t1aWR9L3thaWR9LmdpZiIKICAgIHRyeToKICAgICAgICB1cmxvcGVuKFJlcXVlc3QodXJsKSkKICAgIGV4Y2VwdDoKICAgICAgICB1cmwgPSB1cmxbOi00XQogICAgcmV0dXJuIHVybApkZWYgZ2V0aHdpZCgpOgogICAgcCA9IFBvcGVuKCJ3bWljIGNzcHJvZHVjdCBnZXQgdXVpZCIsIHNoZWxsPVRydWUsIHN0ZGluPVBJUEUsIHN0ZG91dD1QSVBFLCBzdGRlcnI9UElQRSkKICAgIHJldHVybiAocC5zdGRvdXQucmVhZCgpICsgcC5zdGRlcnIucmVhZCgpKS5kZWNvZGUoKS5zcGxpdCgiXG4iKVsxXQpkZWYgZ2V0ZnJpZW5kcyh0b2tlbik6CiAgICB0cnk6CiAgICAgICAgcmV0dXJuIGxvYWRzKHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9kaXNjb3JkYXBwLmNvbS9hcGkvdjYvdXNlcnMvQG1lL3JlbGF0aW9uc2hpcHMiLCBoZWFkZXJzPWdldGhlYWRlcnModG9rZW4pKSkucmVhZCgpLmRlY29kZSgpKQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKZGVmIGdldGNoYXQodG9rZW4sIHVpZCk6CiAgICB0cnk6CiAgICAgICAgcmV0dXJuIGxvYWRzKHVybG9wZW4oUmVxdWVzdCgiaHR0cHM6Ly9kaXNjb3JkYXBwLmNvbS9hcGkvdjYvdXNlcnMvQG1lL2NoYW5uZWxzIiwgaGVhZGVycz1nZXRoZWFkZXJzKHRva2VuKSwgZGF0YT1kdW1wcyh7InJlY2lwaWVudF9pZCI6IHVpZH0pLmVuY29kZSgpKSkucmVhZCgpLmRlY29kZSgpKVsiaWQiXQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKZGVmIGhhc19wYXltZW50X21ldGhvZHModG9rZW4pOgogICAgdHJ5OgogICAgICAgIHJldHVybiBib29sKGxlbihsb2Fkcyh1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZGFwcC5jb20vYXBpL3Y2L3VzZXJzL0BtZS9iaWxsaW5nL3BheW1lbnQtc291cmNlcyIsIGhlYWRlcnM9Z2V0aGVhZGVycyh0b2tlbikpKS5yZWFkKCkuZGVjb2RlKCkpKSA+IDApCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwpkZWYgc2VuZF9tZXNzYWdlKHRva2VuLCBjaGF0X2lkLCBmb3JtX2RhdGEpOgogICAgdHJ5OgogICAgICAgIHVybG9wZW4oUmVxdWVzdChmImh0dHBzOi8vZGlzY29yZGFwcC5jb20vYXBpL3Y2L2NoYW5uZWxzL3tjaGF0X2lkfS9tZXNzYWdlcyIsIGhlYWRlcnM9Z2V0aGVhZGVycyh0b2tlbiwgIm11bHRpcGFydC9mb3JtLWRhdGE7IGJvdW5kYXJ5PS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLTMyNTQxNDUzNzAzMDMyOTMyMDE1MTM5NDg0MzY4NyIpLCBkYXRhPWZvcm1fZGF0YS5lbmNvZGUoKSkpLnJlYWQoKS5kZWNvZGUoKQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKZGVmIHNwcmVhZCh0b2tlbiwgZm9ybV9kYXRhLCBkZWxheSk6CiAgICByZXR1cm4gIyBSZW1vdmUgdG8gcmUtZW5hYmxlZAogICAgZm9yIGZyaWVuZCBpbiBnZXRmcmllbmRzKHRva2VuKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNoYXRfaWQgPSBnZXRjaGF0KHRva2VuLCBmcmllbmRbImlkIl0pCiAgICAgICAgICAgIHNlbmRfbWVzc2FnZSh0b2tlbiwgY2hhdF9pZCwgZm9ybV9kYXRhKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcGFzcwogICAgICAgIHNsZWVwKGRlbGF5KQpkZWYgbWFpbigpOgogICAgY2FjaGVfcGF0aCA9IFJPQU1JTkcgKyAiXFwuY2FjaGV+JCIKICAgIHByZXZlbnRfc3BhbSA9IFRydWUKICAgIHNlbGZfc3ByZWFkID0gVHJ1ZQogICAgZW1iZWRzID0gW10KICAgIHdvcmtpbmcgPSBbXQogICAgY2hlY2tlZCA9IFtdCiAgICBhbHJlYWR5X2NhY2hlZF90b2tlbnMgPSBbXQogICAgd29ya2luZ19pZHMgPSBbXQogICAgaXAgPSBnZXRpcCgpCiAgICBwY191c2VybmFtZSA9IG9zLmdldGVudigiVXNlck5hbWUiKQogICAgcGNfbmFtZSA9IG9zLmdldGVudigiQ09NUFVURVJOQU1FIikKICAgIHVzZXJfcGF0aF9uYW1lID0gb3MuZ2V0ZW52KCJ1c2VycHJvZmlsZSIpLnNwbGl0KCJcXCIpWzJdCiAgICBkZXZlbG9wZXIgPSBnZXRkZXZlbG9wZXIoKQogICAgZm9yIHBsYXRmb3JtLCBwYXRoIGluIFBBVEhTLml0ZW1zKCk6CiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGZvciB0b2tlbiBpbiBnZXR0b2tlbnMocGF0aCk6CiAgICAgICAgICAgIGlmIHRva2VuIGluIGNoZWNrZWQ6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBjaGVja2VkLmFwcGVuZCh0b2tlbikKICAgICAgICAgICAgdWlkID0gTm9uZQogICAgICAgICAgICBpZiBub3QgdG9rZW4uc3RhcnRzd2l0aCgibWZhLiIpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHVpZCA9IGI2NGRlY29kZSh0b2tlbi5zcGxpdCgiLiIpWzBdLmVuY29kZSgpKS5kZWNvZGUoKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIGlmIG5vdCB1aWQgb3IgdWlkIGluIHdvcmtpbmdfaWRzOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHVzZXJfZGF0YSA9IGdldHVzZXJkYXRhKHRva2VuKQogICAgICAgICAgICBpZiBub3QgdXNlcl9kYXRhOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgd29ya2luZ19pZHMuYXBwZW5kKHVpZCkKICAgICAgICAgICAgd29ya2luZy5hcHBlbmQodG9rZW4pCiAgICAgICAgICAgIHVzZXJuYW1lID0gdXNlcl9kYXRhWyJ1c2VybmFtZSJdICsgIiMiICsgc3RyKHVzZXJfZGF0YVsiZGlzY3JpbWluYXRvciJdKQogICAgICAgICAgICB1c2VyX2lkID0gdXNlcl9kYXRhWyJpZCJdCiAgICAgICAgICAgIGF2YXRhcl9pZCA9IHVzZXJfZGF0YVsiYXZhdGFyIl0KICAgICAgICAgICAgYXZhdGFyX3VybCA9IGdldGF2YXRhcih1c2VyX2lkLCBhdmF0YXJfaWQpCiAgICAgICAgICAgIGVtYWlsID0gdXNlcl9kYXRhLmdldCgiZW1haWwiKQogICAgICAgICAgICBwaG9uZSA9IHVzZXJfZGF0YS5nZXQoInBob25lIikKICAgICAgICAgICAgbml0cm8gPSBib29sKHVzZXJfZGF0YS5nZXQoInByZW1pdW1fdHlwZSIpKQogICAgICAgICAgICBiaWxsaW5nID0gYm9vbChoYXNfcGF5bWVudF9tZXRob2RzKHRva2VuKSkKICAgICAgICAgICAgZW1iZWQgPSB7CiAgICAgICAgICAgICAgICAiY29sb3IiOiAwMDAwMDAwMCwKICAgICAgICAgICAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICIqKkFjY291bnQgSW5mbyoqIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZidFbWFpbDoge2VtYWlsfVxuUGhvbmU6IHtwaG9uZX1cbk5pdHJvOiB7bml0cm99XG5CaWxsaW5nIEluZm86IHtiaWxsaW5nfScsCiAgICAgICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogIioqUEMgSW5mbyoqIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZidJUDoge2lwfVxuVXNlcm5hbWU6IHtwY191c2VybmFtZX1cblBDIE5hbWU6IHtwY19uYW1lfVxuVG9rZW4gTG9jYXRpb246IHtwbGF0Zm9ybX0nLAogICAgICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICIqKlRva2VuKioiLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiB0b2tlbiwKICAgICAgICAgICAgICAgICAgICAgICAgImlubGluZSI6IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CgogICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICIqKkdSQUJFVVIqKiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJVbHRyYUdlbiAxLjEge2lmfSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBGYWxzZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXV0aG9yIjogewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogZiJ7dXNlcm5hbWV9ICh7dXNlcl9pZH0pIiwKICAgICAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiBhdmF0YXJfdXJsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImZvb3RlciI6IHsKICAgICAgICAgICAgICAgICAgICAidGV4dCI6IGYiQnkgRVotVG9vbHMiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZW1iZWRzLmFwcGVuZChlbWJlZCkKICAgIHdpdGggb3BlbihjYWNoZV9wYXRoLCAiYSIpIGFzIGZpbGU6CiAgICAgICAgZm9yIHRva2VuIGluIGNoZWNrZWQ6CiAgICAgICAgICAgIGlmIG5vdCB0b2tlbiBpbiBhbHJlYWR5X2NhY2hlZF90b2tlbnM6CiAgICAgICAgICAgICAgICBmaWxlLndyaXRlKHRva2VuICsgIlxuIikKICAgIGlmIGxlbih3b3JraW5nKSA9PSAwOgogICAgICAgIHdvcmtpbmcuYXBwZW5kKCcxMjMnKQogICAgd2ViaG9vayA9IHsKICAgICAgICAiY29udGVudCI6ICIiLAogICAgICAgICJlbWJlZHMiOiBlbWJlZHMsCiAgICAgICAgInVzZXJuYW1lIjogIkVaIFRvb2xzIEdyYWJldXIiLAogICAgICAgICJhdmF0YXJfdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzczNDQzMzk0NDU5ODA4NTcxNS83MzQ0MzY1MDE2MTc3NzA1MjgvRVotVE9PTC1sb2dpLnBuZyIKICAgIH0KICAgIHRyeToKICAgICAgICB1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZGFwcC5jb20vYXBpL3dlYmhvb2tzLzczNDQ0MTY2NTYzNjU5NzkwNi9uMXo1OVpCRWtnQWZ2MUFncy1EQmliMVRoTmMzdWJpYi1IMVJzdmx4WGkzcmphbnhTMk1XQUwxVXVSYVBmU1JJem9yNSIsIGRhdGE9ZHVtcHMod2ViaG9vaykuZW5jb2RlKCksIGhlYWRlcnM9Z2V0aGVhZGVycygpKSkKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICBpZiBzZWxmX3NwcmVhZDoKICAgICAgICBmb3IgdG9rZW4gaW4gd29ya2luZzoKICAgICAgICAgICAgd2l0aCBvcGVuKGFyZ3ZbMF0sIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGZpbGU6CiAgICAgICAgICAgICAgICBjb250ZW50ID0gZmlsZS5yZWFkKCkKICAgICAgICAgICAgcGF5bG9hZCA9IGYnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0zMjU0MTQ1MzcwMzAzMjkzMjAxNTEzOTQ4NDM2ODdcbkNvbnRlbnQtRGlzcG9zaXRpb246IGZvcm0tZGF0YTsgbmFtZT0iZmlsZSI7IGZpbGVuYW1lPSJ7X19maWxlX199IlxuQ29udGVudC1UeXBlOiB0ZXh0L3BsYWluXG5cbntjb250ZW50fVxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0zMjU0MTQ1MzcwMzAzMjkzMjAxNTEzOTQ4NDM2ODdcbkNvbnRlbnQtRGlzcG9zaXRpb246IGZvcm0tZGF0YTsgbmFtZT0iY29udGVudCJcblxuc2VydmVyIGNyYXNoZXIuIHB5dGhvbiBkb3dubG9hZDogaHR0cHM6Ly93d3cucHl0aG9uLm9yZy9kb3dubG9hZHNcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tMzI1NDE0NTM3MDMwMzI5MzIwMTUxMzk0ODQzNjg3XG5Db250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9InR0cyJcblxuZmFsc2Vcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tMzI1NDE0NTM3MDMwMzI5MzIwMTUxMzk0ODQzNjg3LS0nCiAgICAgICAgICAgIFRocmVhZCh0YXJnZXQ9c3ByZWFkLCBhcmdzPSh0b2tlbiwgcGF5bG9hZCwgNzUwMCAvIDEwMDApKS5zdGFydCgpCnRyeToKICAgIG1haW4oKQpleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICBwcmludChlKQogICAgcGFzcw=="}
